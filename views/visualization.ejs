<!DOCTYPE html>
<html>

<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/randomcolor/0.5.2/randomColor.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.dom.min.js"></script>

  <link href="https://fonts.googleapis.com/css?family=Work+Sans:100,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Schoolbell" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">

  <title>
    <%= title %>
  </title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
</head>

<body>
    <!--  -->
    <div class="container">
        <div class="cat">
            <div class="face">
                <div class="ear-l">
                        <div class="inner1"></div>
                </div>
                <div class="ear-r">
                    <div class="inner2"></div>
                </div>
                <div class="eye-l">
                    <div class="eyeball"></div>
                </div>
                <div class="eye-r">
                    <div class="eyeball"></div>
                </div>
                <div class="nose">
                    <div class="l1"></div>
                    <div class="l2"></div>
                    <div class="l3"></div>
                    <div class="l4"></div>
                </div>
            </div>
            <div class="body">
                <div class="paw-l"></div>
                <div class="paw-r"></div>
                <div class="tail"></div>
            </div>
        </div>
        <div>
          <div class="ball1"></div>
          <div class="ball2"></div>
          <div class="ball3"></div>
        </div>
    </div>

    <!-- user -->
    <div class="t1" style="color:var(--ball1-color);">
    <a id="username" color>
        <%= u %>
    </a><a>'s cattify</a>
    <div class="t6" style="color:var(--ball1-color);">ⓘ
    <span class="tooltiptext">
        <p>Your cat is <b><a id="valenceType"></a></b> because you've recently listened to music that relates to <b id="valenceString"></b> emotions.</p>
        <p>Your cat's <b>eyes</b> are a <b><a id="modeType"></a></b> color because your recent music is mostly in the <b id="mode"></b> key.</p>
        <p>The <b>background</b> of your cat is a <b><a id="energy"></a></b> color because you've listened to <b><a id="energy1"></a> energetic</b> songs.</p>
        <p>You've been <b><a id="listener"></a> listener</b> during the past 24 hours, so your cat has <b><a id="numToys"></a></b> toy(s).</p>
        <p>Your cat's <b>fur</b> is a(n) <b><a id="keyColor"></a></b> color because your songs are mostly in the <b>key</b> <a id="keyName"><a>.</p>
    </span>
    </div>
    </div>
<!-- </body> -->

<style>

body {
    padding: 0;
    margin: 0;
    background-color: var(--bg-color);
}

.container {
    height: 500px;
    width: 350px;
    position: absolute;
    margin: auto;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: -1;
}

@media only screen and (max-device-width: 768px) {
  /* For mobile phones: */
  .container {
    bottom: 25%;
  }
}

.cat {
    position: relative;
    top: 150px;
    left: 50px;
}

.face {
    background-color: var(--fur-color);
    height: 90px;
    width: 150px;
    border-radius: 40%;
}

.ear-l,.ear-r {
    width: 0;
    height: 0;
    border-bottom: 50px solid var(--fur-color);
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    position: relative;
    z-index: -1;
}

.ear-l {
    bottom: 35px;
    transform: rotate(-30deg);
}

.ear-r {
    bottom: 85px;
    left: 110px;
    transform: rotate(30deg);
}

.inner1 {
    width: 0;
    height: 0;
    border-bottom: 50px solid var(--eye-color);
    border-left: 25px solid transparent;
    right: 25px;
    position: relative;
}

.inner2 {
    width: 0;
    height: 0;
    border-bottom: 50px solid var(--eye-color);
    border-right: 25px solid transparent;
    position: relative;
}

.eye-l,.eye-r {
    background-color: var(--eye-color);
    height: 30px;
    width: 30px;
    border-radius: 50%;
    position: relative;
}

.eye-l {
    bottom: 75px;
    left: 30px;
}

.eye-r {
    bottom: 105px;
    left: 90px;
}

.eyeball {
    background-color: #332928;
    height: 22px;
    width: 22px;
    border-radius: 50%;
    position: relative;
    top: 4px;
    left: 4px;
}

.nose {
    height: 0;
    width: 0;
    border-top: 8px solid var(--eye-color);
    border-left: 7px solid transparent;
    border-right: 7px solid transparent;
    position: relative;
    bottom: 110px;
    left: 68px;
}

.l1,.l2 {
		background-color: var(--frown-color);
    height: 8px;
    width: 2px;
    position: relative;
    border-radius: 0 0 10px 0;
}

.l1 {
    transform: rotate(45deg);
    right: 4px;
    bottom: 2px;
}

.l2 {
    transform: rotate(-45deg);
    bottom: 10.5px;
    left: 2.5px;
}

.l3,.l4 {
  background-color: transparent;
  height: 7px;
  width: 12px;
  position: relative;
  border-radius: 100%;
  border-bottom:solid 3px var(--smile-color);
}

.l3 {
  right: 11px;
  bottom: 24px;
}

.l4 {
  bottom: 34px;
  left: -1px;
}

.body {
    background-color: var(--fur-color);
    height: 120px;
    width: 130px;
    position: relative;
    left: 30px;
    bottom: 5px;
    border-radius: 0 65px 0 0;
}

.paw-l,.paw-r {
    background-color: var(--fur-color);
    height: 10px;
    width: 22px;
    position: relative;
    border-radius: 0 0px 10px 10px;
}

.paw-l {
    top: 120px;
}

.paw-r {
    top: 110px;
    left: 50px;
}

.tail {
    background-color: var(--fur-color);
    width: 100px;
    height: 20px;
    position: relative;
    top: 80px;
    left: 100px;
    border-radius: 0 20px 20px 0;
}

.ball1,.ball2,.ball3 {
    width: 30px;
    height: 30px;
    position: relative;
    top: 125px;
    border-radius: 50%;
    display: inline-block;
}
.ball1 {
    background-color: var(--ball1-color);
}
.ball2 {
    background-color: var(--ball2-color);
}
.ball3 {
    background-color: var(--ball3-color);
}
    
</style>

<script>
  // Fade in on start
  $(document).ready(function() {
    $("body").hide().fadeIn(2000);
  });

  if (/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)) {
    var canvasW = 800;
    var canvasH = 800;
  } else {
    var canvasW = 960;
    var canvasH = 360;
  }

  var Y_AXIS = 1;
  var X_AXIS = 2;

  ////////// MUSIC VARIABLES ////////////
  var mode = '<%= d.mode %>';
  var valence = '<%= d.valence %>';
  var energy = '<%= d.energy %>';
  var toyN = '<%= t %>'; // can be 0,1,2
  var musicKey = '<%= d.key %>'; // from 0 to 11


  //////////////////////////////////////
  var valenceType;

	var smileColor;
	var frownColor;


  var modeType;
  var modeColor;
  var musicWarmHues = ['brown', 'chocolate', 'coral', 'darkorange', 'darksalmon', 'deeppink', 'hotpink', 'magenta', 'yellow'];
	var musicDarkHues = ['green', 'navy', 'teal', 'aqua', 'blue', 'cadetblue', 'cornflowerblue', 'darkblue', 'darkcyan', 'darkgreen', 'indigo', 'navy', 'royalblue', 'slateblue'];
  var musicKHues = ['thistle', 'silver', 'black', 'white', 'wheat', 'powderblue', 'tan', 'lavenderblush', 'lavender', 'gold', 'lightgoldenrodyellow', 'gray']; 

  var keyNames = ["C", "C♯/D♭", "D", "D♯/E♭", "E", "F", "F♯/G♭", "G", "G♯/A♭", "A", "A♯/B♭", "B"];
  var oppColor;
  var ball1Color;
  var ball2Color;
  var ball3Color;

  /////////////////////////////////////


  function setup() {

    // MODE -- eye color
    if (mode == 1) {
      // Major mode --- warmer toned
      modeType = "warmer-toned";
      modeColor = musicWarmHues[Math.floor(Math.random()*musicWarmHues.length)];
      document.getElementById("modeType").innerText = modeType
      document.getElementById("modeType").style.color = shadeColor(colorNameToHex(modeColor), -20);
      document.getElementById("mode").innerText = "major";
    } else if (mode == 0) {
      // Minor mode --- cooler toned
      modeType = "cooler-toned";
      modeColor = musicCoolHues[Math.floor(Math.random()*musicWarmHues.length)];
      document.getElementById("modeType").innerText = modeType;
      document.getElementById("modeType").style.color = shadeColor(colorNameToHex(modeColor), -20);
      document.getElementById("mode").innerText = "minor";
    }

		// VALENCE -- mouth type
		if (valence > 0.5) {
        smileColor = modeColor;
				frownColor = "transparent";
        valenceType = "smiling";
    } else {
        smileColor = "transparent";
				frownColor = modeColor;
        valenceType = "frowning";
    }

    // FOR THE TOOLTIP
    document.getElementById("valenceType").innerText = valenceType;
    if (valence > 0.5)
      document.getElementById("valenceString").innerText = "happy or cheerful";
    else
      document.getElementById("valenceString").innerText = "sad or angry";

		// ENERGY --- background color
    if (energy > 0.5) {
			bkgdColor = randomColor({luminosity:'bright'});
      document.getElementById("energy").innerText = "brighter";
      document.getElementById("energy").style.color = shadeColor(bkgdColor,-20);
      document.getElementById("energy1").innerText = "more";
    } else {
			bkgdColor= randomColor({luminosity:'dark'});
      document.getElementById("energy").innerText = "dimmer";
      document.getElementById("energy").style.color = shadeColor(bkgdColor,-20);
      document.getElementById("energy1").innerText = "less";
    }

    // KEY --- fur colors
    var currentHue = musicKHues[musicKey];


    // FOR THE TOOLTIP
    document.getElementById("keyColor").innerText = currentHue;
    document.getElementById("keyColor").style.color = shadeColor(colorNameToHex(currentHue), -20);
    document.getElementById("keyName").innerText = keyNames[musicKey];

    // LISTENS PER HOUR --- number of toys
    oppColor = invertColor(bkgdColor);
    ball1Color = oppColor;
    ball2Color = oppColor;
    ball3Color = oppColor;
    if (toyN == 2) {
      toyN = 0;
      ball2Color = "transparent";
      ball3Color = "transparent";
      document.getElementById("listener").innerText = "a less active";
      document.getElementById("numToys").innerText = "one";
    } else if (toyN == 0) {
      toyN = 2;
      document.getElementById("listener").innerText = "a very active";
      document.getElementById("numToys").innerText = "three";
    } else if (toyN == 1) {
      ball3Color = "transparent";
      document.getElementById("listener").innerText = "an active";
      document.getElementById("numToys").innerText = "two";
    }

    // Background
    document.documentElement.style.setProperty('--bg-color', bkgdColor);
		document.documentElement.style.setProperty('--smile-color', smileColor);
		document.documentElement.style.setProperty('--frown-color', frownColor);
    document.documentElement.style.setProperty('--fur-color', currentHue);
    document.documentElement.style.setProperty('--eye-color', modeColor);
    document.documentElement.style.setProperty('--ball1-color', ball1Color);
    document.documentElement.style.setProperty('--ball2-color', ball2Color);
    document.documentElement.style.setProperty('--ball3-color', ball3Color);
    

  }

  function shadeColor(color, percent) {

    var R = parseInt(color.substring(1,3),16);
    var G = parseInt(color.substring(3,5),16);
    var B = parseInt(color.substring(5,7),16);

    R = parseInt(R * (100 + percent) / 100);
    G = parseInt(G * (100 + percent) / 100);
    B = parseInt(B * (100 + percent) / 100);

    R = (R<255)?R:255;  
    G = (G<255)?G:255;  
    B = (B<255)?B:255;  

    R = Math.round(R)
    G = Math.round(G)
    B = Math.round(B)

    var RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
    var GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
    var BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));

    return "#"+RR+GG+BB;
}
function invertColor(hex) {
    if (hex.indexOf('#') === 0) {
        hex = hex.slice(1);
    }
    // convert 3-digit hex to 6-digits.
    if (hex.length === 3) {
        hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
    }
    if (hex.length !== 6) {
        throw new Error('Invalid HEX color.');
    }
    // invert color components
    var r = (255 - parseInt(hex.slice(0, 2), 16)).toString(16),
        g = (255 - parseInt(hex.slice(2, 4), 16)).toString(16),
        b = (255 - parseInt(hex.slice(4, 6), 16)).toString(16);
    // pad each with zeros and return
    return '#' + padZero(r) + padZero(g) + padZero(b);
}

function padZero(str, len) {
    len = len || 2;
    var zeros = new Array(len).join('0');
    return (zeros + str).slice(-len);
}

function colorNameToHex(color)
{
    var colors = {"aliceblue":"#f0f8ff","antiquewhite":"#faebd7","aqua":"#00ffff","aquamarine":"#7fffd4","azure":"#f0ffff",
    "beige":"#f5f5dc","bisque":"#ffe4c4","black":"#000000","blanchedalmond":"#ffebcd","blue":"#0000ff","blueviolet":"#8a2be2","brown":"#a52a2a","burlywood":"#deb887",
    "cadetblue":"#5f9ea0","chartreuse":"#7fff00","chocolate":"#d2691e","coral":"#ff7f50","cornflowerblue":"#6495ed","cornsilk":"#fff8dc","crimson":"#dc143c","cyan":"#00ffff",
    "darkblue":"#00008b","darkcyan":"#008b8b","darkgoldenrod":"#b8860b","darkgray":"#a9a9a9","darkgreen":"#006400","darkkhaki":"#bdb76b","darkmagenta":"#8b008b","darkolivegreen":"#556b2f",
    "darkorange":"#ff8c00","darkorchid":"#9932cc","darkred":"#8b0000","darksalmon":"#e9967a","darkseagreen":"#8fbc8f","darkslateblue":"#483d8b","darkslategray":"#2f4f4f","darkturquoise":"#00ced1",
    "darkviolet":"#9400d3","deeppink":"#ff1493","deepskyblue":"#00bfff","dimgray":"#696969","dodgerblue":"#1e90ff",
    "firebrick":"#b22222","floralwhite":"#fffaf0","forestgreen":"#228b22","fuchsia":"#ff00ff",
    "gainsboro":"#dcdcdc","ghostwhite":"#f8f8ff","gold":"#ffd700","goldenrod":"#daa520","gray":"#808080","green":"#008000","greenyellow":"#adff2f",
    "honeydew":"#f0fff0","hotpink":"#ff69b4",
    "indianred ":"#cd5c5c","indigo":"#4b0082","ivory":"#fffff0","khaki":"#f0e68c",
    "lavender":"#e6e6fa","lavenderblush":"#fff0f5","lawngreen":"#7cfc00","lemonchiffon":"#fffacd","lightblue":"#add8e6","lightcoral":"#f08080","lightcyan":"#e0ffff","lightgoldenrodyellow":"#fafad2",
    "lightgrey":"#d3d3d3","lightgreen":"#90ee90","lightpink":"#ffb6c1","lightsalmon":"#ffa07a","lightseagreen":"#20b2aa","lightskyblue":"#87cefa","lightslategray":"#778899","lightsteelblue":"#b0c4de",
    "lightyellow":"#ffffe0","lime":"#00ff00","limegreen":"#32cd32","linen":"#faf0e6",
    "magenta":"#ff00ff","maroon":"#800000","mediumaquamarine":"#66cdaa","mediumblue":"#0000cd","mediumorchid":"#ba55d3","mediumpurple":"#9370d8","mediumseagreen":"#3cb371","mediumslateblue":"#7b68ee",
    "mediumspringgreen":"#00fa9a","mediumturquoise":"#48d1cc","mediumvioletred":"#c71585","midnightblue":"#191970","mintcream":"#f5fffa","mistyrose":"#ffe4e1","moccasin":"#ffe4b5",
    "navajowhite":"#ffdead","navy":"#000080",
    "oldlace":"#fdf5e6","olive":"#808000","olivedrab":"#6b8e23","orange":"#ffa500","orangered":"#ff4500","orchid":"#da70d6",
    "palegoldenrod":"#eee8aa","palegreen":"#98fb98","paleturquoise":"#afeeee","palevioletred":"#d87093","papayawhip":"#ffefd5","peachpuff":"#ffdab9","peru":"#cd853f","pink":"#ffc0cb","plum":"#dda0dd","powderblue":"#b0e0e6","purple":"#800080",
    "rebeccapurple":"#663399","red":"#ff0000","rosybrown":"#bc8f8f","royalblue":"#4169e1",
    "saddlebrown":"#8b4513","salmon":"#fa8072","sandybrown":"#f4a460","seagreen":"#2e8b57","seashell":"#fff5ee","sienna":"#a0522d","silver":"#c0c0c0","skyblue":"#87ceeb","slateblue":"#6a5acd","slategray":"#708090","snow":"#fffafa","springgreen":"#00ff7f","steelblue":"#4682b4",
    "tan":"#d2b48c","teal":"#008080","thistle":"#d8bfd8","tomato":"#ff6347","turquoise":"#40e0d0",
    "violet":"#ee82ee",
    "wheat":"#f5deb3","white":"#ffffff","whitesmoke":"#f5f5f5",
    "yellow":"#ffff00","yellowgreen":"#9acd32"};

    if (typeof colors[color.toLowerCase()] != 'undefined')
        return colors[color.toLowerCase()];

    return false;
}

</script>



</html>
