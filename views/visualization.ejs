<!DOCTYPE html>
<html>

<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/randomcolor/0.5.2/randomColor.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.dom.min.js"></script>

  <link href="https://fonts.googleapis.com/css?family=Work+Sans:100,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Schoolbell" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">

  <title>
    <%= title %>
  </title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
</head>

<body>
    <!--  -->
    <div class="container">
        <div class="cat">
            <div class="face">
                <div class="ear-l">
                        <div class="inner1"></div>
                </div>
                <div class="ear-r">
                    <div class="inner2"></div>
                </div>
                <div class="eye-l">
                    <div class="eyeball"></div>
                </div>
                <div class="eye-r">
                    <div class="eyeball"></div>
                </div>
                <div class="nose">
                    <div class="l1"></div>
                    <div class="l2"></div>
                </div>
            </div>
            <div class="body">
                <div class="paw-l"></div>
                <div class="paw-r"></div>
                <div class="tail"></div>
            </div>
        </div>
    </div>

    <!-- user -->
    <div class="t1">
    <a id="username">
        <%= u %>
    </a><a>'s spawtify</a>
    <span class="tooltiptext">
        <p>The <b>backgound</b> of your musicScape is a <a id="valenceColorType"></a> color because you've recently listened to music that relates to <b id="valenceString"></b> emotions.</p>
        <p>Your cat's <b>eyes</b> are a <a id="modeType"></a> color because your recent music is mostly in the <b id="mode"></b> key.</p>
        <p>Your cat is <b><a id="energy"></a> sleepy</b> because you've listened to <b><a id="energy1"></a> energetic</b> songs.</p>
        <p>You've been <b><a id="listener"></a> listener</b> during the past 24 hours, so your cat has <a id="numToys"></a> toy(s).</p>
        <p>Your cat's <b>fur</b> is a <a id="keyColor"></a> color because your songs are mostly in the <b>key</b> <a id="keyName"><a>.</p>
    </span>
    </div>
<!-- </body> -->

<style>

body {
    padding: 0;
    margin: 0;
    background-color: var(--bg-color);
}

.container {
    height: 500px;
    width: 350px;
    position: absolute;
    margin: auto;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: -1;
}

.cat {
    position: relative;
    top: 150px;
    left: 50px;
}

.face {
    background-color: var(--fur-color);
    height: 90px;
    width: 150px;
    border-radius: 40%;
}

.ear-l,.ear-r {
    width: 0;
    height: 0;
    border-bottom: 50px solid var(--fur-color);
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    position: relative;
    z-index: -1;
}

.ear-l {
    bottom: 35px;
    transform: rotate(-30deg);
}

.ear-r {
    bottom: 85px;
    left: 110px;
    transform: rotate(30deg);
}

.inner1 {
    width: 0;
    height: 0;
    border-bottom: 50px solid var(--eye-color);
    border-left: 25px solid transparent;
    right: 25px;
    position: relative;
}

.inner2 {
    width: 0;
    height: 0;
    border-bottom: 50px solid var(--eye-color);
    border-right: 25px solid transparent;
    position: relative;
}

.eye-l,.eye-r {
    background-color: var(--eye-color);
    height: 30px;
    width: 30px;
    border-radius: 50%;
    position: relative;
}

.eye-l {
    bottom: 75px;
    left: 30px;
}

.eye-r {
    bottom: 105px;
    left: 90px;
}

.eyeball {
    background-color: #332928;
    height: 22px;
    width: 22px;
    border-radius: 50%;
    position: relative;
    top: 4px;
    left: 4px;
}

.nose {
    height: 0;
    width: 0;
    border-top: 8px solid var(--eye-color);
    border-left: 7px solid transparent;
    border-right: 7px solid transparent;
    position: relative;
    bottom: 110px;
    left: 68px;
}

.l1,.l2 {
    background-color: var(--eye-color);
    height: 8px;
    width: 2px;
    position: relative;
    border-radius: 0 0 10px 0;
}

.l1 {
    transform: rotate(45deg);
    right: 4px;
    bottom: 2px;
}

.l2 {
    transform: rotate(-45deg);
    bottom: 10.5px;
    left: 2.5px;
}

.body {
    background-color: var(--fur-color);
    height: 120px;
    width: 130px;
    position: relative;
    left: 30px;
    bottom: 5px;
    border-radius: 0 65px 0 0;
}

.paw-l,.paw-r {
    background-color: var(--fur-color);
    height: 10px;
    width: 22px;
    position: relative;
    border-radius: 0 0px 10px 10px;
}

.paw-l {
    top: 120px;
}

.paw-r {
    top: 110px;
    left: 50px;
}

.tail {
    background-color: var(--fur-color);
    width: 100px;
    height: 20px;
    position: relative;
    top: 80px;
    left: 100px;
    border-radius: 0 20px 20px 0;
}
    
</style>

<script>
  // Fade in on start
  $(document).ready(function() {
    $("body").hide().fadeIn(2000);
  });

  if (/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)) {
    var canvasW = 800;
    var canvasH = 800;
  } else {
    var canvasW = 960;
    var canvasH = 360;
  }

  var Y_AXIS = 1;
  var X_AXIS = 2;

  ////////// MUSIC VARIABLES ////////////
  var mode = '<%= d.mode %>';
  var valence = '<%= d.valence %>';
  var energy = '<%= d.energy %>';
  var toyN = '<%= t %>'; // can be 0,1,2
  var musicKey = '<%= d.key %>'; // from 0 to 11


  //////////////////////////////////////

  var valenceColor;
  var valenceColorType;
  var modeType;
  var modeColor;
  var musicHues = ['darkseagreen', 'blue', 'green', 'purple', 'fuschia', 'indianred', 'orange', 'yellow'];
 
  var musicKHues = ['thistle', 'silver', 'black', 'white', 'wheat', 'powderblue', 'orange', 'olive', 'lavendar', 'gold', 'lightgoldenrodyellow', 'gray']; 

  var keyNames = ["C", "C♯/D♭", "D", "D♯/E♭", "E", "F", "F♯/G♭", "G", "G♯/A♭", "A", "A♯/B♭", "B"];
  var furColors;
  var backgroundColor;

  /////////////////////////////////////


  function setup() {

    // VALENCE -- background color
    if (valence > 0.5) {
        valenceColor = randomColor({luminosity:'bright'});
        valenceColorType = "brighter";
    } else {
        valenceColor = randomColor({luminosity:'dark'});
        valenceColorType = "dimmer";
    }
    backgroundColor = color(valenceColor);

    // MODE -- eye color
    if (mode == 1) {
      // Major mode --- warmer toned
      modeType = "warmer-toned";
      modeColor = musicHues[(Math.floor(Math.random() * (7 - 4 + 1)) + 4)];
      document.getElementById("modeType").innerText = modeType;
      document.getElementById("mode").innerText = "major";
    } else if (mode == 0) {
      // Minor mode --- cooler toned
      modeType = "cooler-toned";
      modeColor = musicHues[(Math.floor(Math.random() * (3 - 0 + 1)) + 0)];
      document.getElementById("modeType").innerText = modeType;
      document.getElementById("mode").innerText = "minor";
    }

    // FOR THE TOOLTIP
    document.getElementById("valenceColorType").innerText = valenceColorType;
    document.getElementById("valenceColorType").style.color = backgroundColor;
    if (valence > 0.5)
      document.getElementById("valenceString").innerText = "happy or cheerful";
    else
      document.getElementById("valenceString").innerText = "sad or angry";

    if (energy > 0.5) {
      document.getElementById("energy").innerText = "less";
      document.getElementById("energy1").innerText = "more";
    } else {
      document.getElementById("energy").innerText = "more";
      document.getElementById("energy1").innerText = "less";
    }

    // KEY --- fur colors
    var currentHue = musicKHues[musicKey];

    furColors = color(currentHue)

    // FOR THE TOOLTIP
    document.getElementById("keyColor").innerText = currentHue.toString();
    document.getElementById("keyColor").style.color = furColors;
    document.getElementById("keyName").innerText = keyNames[musicKey];

    // LISTENS PER HOUR --- number of toys
    if (toyN == 2) {
      toyN = 0;
      document.getElementById("listener").innerText = "a less active";
      document.getElementById("numToys").innerText = "one";
    } else if (toyN == 0) {
      toyN = 2;
      document.getElementById("listener").innerText = "a very active";
      document.getElementById("numToys").innerText = "three";
    } else if (toyN == 1) {
      document.getElementById("listener").innerText = "an active";
      document.getElementById("numToys").innerText = "two";
    }

    // Background
    document.documentElement.style.setProperty('--bg-color', valenceColor);
    document.documentElement.style.setProperty('--fur-color', furColors);
    document.documentElement.style.setProperty('--eye-color', modeColor);
    

  }
</script>



</html>
